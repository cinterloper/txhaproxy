Transactional Haproxy:

This aims to provide transactional verification, reload (and versioned rollback, when i get around to it) for haproxy configurations.

the jinja template included renders the haproxy configuration, it is based on:
https://github.com/saltstack-formulas/haproxy-formula

there is a script that attempts to verify the new configuration with haproxy's configuration checking mechanism, and install it, requesting haproxy to do a self-reload (I believe the safest way to reload haproxy)

as a service interface, with no dependencies, You may submit a Json or Yaml data structure to render the template. 

optionally it can be hooked into a saltstack master, for remote control. this is optional.


grant@nighthawk ..ndShadow/controllerContainer/txhaproxy (git)-[master] % docker build -t txhaproxy .                                                        
Successfully built b31182715abc

grant@nighthawk ..ndShadow/controllerContainer/txhaproxy (git)-[master] % docker run -p 9955:9955 -p 3003:3003 -d -v $(pwd)/web:/opt/web txhaproxy 
a778e60a63e2511bdb31ad59ef1dad8963a1d1dab183eaa07a034a7e7456c5d1

grant@nighthawk ..ndShadow/controllerContainer/txhaproxy (git)-[master] % http http://localhost:3003 < example/example.json
HTTP/1.1 200 OK
Connection: keep-alive
Content-Type: text/plain
Date: Mon, 23 Nov 2015 06:43:51 GMT
Transfer-Encoding: chunked
X-Powered-By: Express

you posted:
9ba64e0e60544c5bd091731347e8f78e
grant@nighthawk ..ndShadow/controllerContainer/txhaproxy (git)-[master] % http http://localhost:3003 < example/example.json                                        
HTTP/1.1 200 OK
Connection: keep-alive
Content-Type: text/plain
Date: Mon, 23 Nov 2015 06:45:01 GMT
Transfer-Encoding: chunked
X-Powered-By: Express

you posted:
2701f47fdb40b6b7e0b4f7fd56e298f5

grant@nighthawk ..ndShadow/controllerContainer/txhaproxy (git)-[master] % docker logs a778e60a63e2511bdb31ad59ef1dad8963a1d1dab183eaa07a034a7e7456c5d1 2>&1 | tail -n 30
          ID: /etc/haproxy/reload.sh
    Function: cmd.run
      Result: True
     Comment: Command "/etc/haproxy/reload.sh" run
     Started: 06:45:04.051630
    Duration: 232.679 ms
     Changes:   
              ----------
              pid:
                  79
              retcode:
                  0
              stderr:
                  [WARNING] 326/064504 (81) : config : log format ignored for frontend 'www-http' since it has no log address.
                  [WARNING] 326/064504 (84) : config : log format ignored for frontend 'www-http' since it has no log address.
              stdout:
                  78c78
                  <     server net icanhazip.com:80 check 
                  ---
                  >     server net 172.17.42.1:8666 check 
                  Configuration file is valid

Summary for local
------------
Succeeded: 2 (changed=2)
Failed:    0
------------
Total states run:     2
Total run time: 653.497 ms
I think it worked

grant@nighthawk ..ndShadow/controllerContainer/txhaproxy (git)-[master] % curl http://localhost:9955/
6x.x.100.x

